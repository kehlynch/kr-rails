<%= form_with model: @game, url: match_player_game_path(@match_id, @player_id, @game.id), local: true, html: {id: "gameForm"}, class: 'game-container' do |form| %>
  <input hidden=true name="game[action]" value=<%= @action %> id="js-stage" data-stage=<%= @action %> data-human-player=<%= @game.next_player_human? %> data-bid-slug=<%= @player.declarer? && @bids.winning_bid_slug %> />
  <% if @waiting %>
    <input hidden=true id="reload-on-match-msg" data-match-id=<%= @match_id %> />
  <% end %>

  <%= render 'message', message: @message %>

  <%= render 'players', form: form %>

  <% if @action == 'make_bid' && @game.next_player&.id == @player.id %>
    <%= render 'bid', player: @player %>
  <% end %>

  <% if @action == 'make_announcement' && @game.next_player.id == @player.id %>
    <%= render 'announcement', player: @player, form: form %>
  <% end %>

  <%= render 'hand', form: form %>

  <% if @action == 'pick_king' %>
    <%= render 'kings'  %>
  <% end %>

  <% if ['pick_talon', 'pick_whole_talon'].include?(@action) || (@action == 'resolve_talon' && !@player.declarer?) %>
    <%= render 'talon', talon: @game.talon %>
  <% end %>

  <% if ['play_card', 'next_trick', 'finished'].include?(@action) %>
    <%= render 'trick', cards: @tricks.trick_cards, form: form %>
  <% end %>

  <% if @game.stage == 'finished' %>
    <%= render 'score' %>
    <%= render 'matches/points' %>
  <% end %>

  <div class="new-game-button-container">
    <%= link_to 'New game', new_match_path, class: 'btn btn-outline-dark new-game-button' %>
  </div>

  <% if @game.stage == 'finished' %>
    <div class="finished-buttons">
      <div>
        <%= button_tag 'Show hand scores', type: 'button', class: 'btn btn-outline-dark new-game-button', onClick: 'showScores()' %>
      </div>

      <div>
        <%= button_tag 'Show game points', type: 'button', class: 'btn btn-outline-dark new-game-button', onClick: 'showPoints()' %>
      </div>

      <div>
        <%= form.submit "next hand", class: 'btn btn-outline-dark new-game-button' %>
      </div>
    </div>
  <% end %>
<% end %>
